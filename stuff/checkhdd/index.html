<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width" /> <meta name="google-site-verification" content="riBpdQWal9w_jxf97W3pf6jUQs7jkzT3U2UOi9MZuPY" /> <title>Check new Hard Disk before use</title> <link rel="stylesheet" href="/css/w3.css"> <link rel="stylesheet" href="/css/main.css" type="text/css" /> <link rel="stylesheet" href="/css/pygments-default.css" type="text/css" /> <script src="https://kit.fontawesome.com/cf75892fab.js" crossorigin="anonymous"></script> <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'> <style>body{font-family: 'Open Sans', sans-serif;}</style> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS8LGHNGNZ"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SS8LGHNGNZ'); </script> </head> <body> <header> <div id="title"> <h1>3dz2.com</h1> <h2></h2> </div> <img src="/img/banners/research.png" alt="image banner" /> </header> <main> <article> <h1 id="check-new-hard-disk-before-use">Check new Hard Disk before use</h1> <hr /> <p>This is my procedure to check a new hard drive for early failures before using it.</p> <p>This procedure is destructive! You will lose data if you are not careful!</p> <p>Use it at your own risk. Don’t blame me.</p> <p>Use it only on HDD not SSD.</p> <p>Change sdX with the correct device id.</p> <p>1 - Get the current HD status via smartctl<br /> <code class="highlighter-rouge">sudo smartctl -a /dev/sdX &gt; smartctl_sdX_`date +"%Y-%m-%d"`.txt</code></p> <p>2 - Get the block size<br /> <code class="highlighter-rouge">sudo hdparm -I /dev/sdX | grep Physical</code></p> <p>3 - Run badblocks (will take a couple of days). This command is destructive! All data on drive will be lost! Each one needs about 10h to complete for a 4TB disk.<br /> <code class="highlighter-rouge">sudo badblocks -wsv -b 4096 -t 0xaa /dev/sdX</code><br /> <code class="highlighter-rouge">sudo badblocks -wsv -b 4096 -t 0x55 /dev/sdX</code></p> <p>4 - Run smartctl short and long tests (the long test will take few hours)<br /> <code class="highlighter-rouge">sudo smartctl -t short /dev/sdX</code><br /> <code class="highlighter-rouge">sudo smartctl -t long /dev/sdX</code></p> <p>5 - Get the current HD status via smartctl<br /> <code class="highlighter-rouge">sudo smartctl -a /dev/sdX &gt; smartctl_sdX_`date +"%Y-%m-%d"`.txt</code></p> <p>6 - Compare the two smartctl outputs for differences, in particular the reallocated sector count (<code class="highlighter-rouge">Reallocated_Sector_Ct</code>) which should be zero.</p> <p>7- Create a new GPT:<br /> <code class="highlighter-rouge">sudo gdisk /dev/sdX</code><br /> If asked, select 2 (create blank GPT), then:<br /> <code class="highlighter-rouge">o</code> (create a new empty GUID partition table (GPT))<br /> <code class="highlighter-rouge">n</code> (add a new partition, keep defaults, use 8300 Linux filesystem)<br /> <code class="highlighter-rouge">p</code> (print the partition table)<br /> <code class="highlighter-rouge">w</code> (write table to disk and exit)</p> <p>8 - Format as ext4<br /> <code class="highlighter-rouge">sudo mkfs -t ext4 /dev/sdX1</code><br /> It may complain with: <code class="highlighter-rouge">/dev/sdX1 contains `VISX image file' data</code><br /> Not sure about what it means, but just say y.</p> <p>9 - (optional) Change label (name) of the partition. Mostly useful for external (USB) drives.<br /> <code class="highlighter-rouge">sudo e2label /dev/sdX1 your_label_name</code></p> <p>10 - Setup smartctl to run a short test every day and a long test once a week (and some other warnings…)<br /> Add in <code class="highlighter-rouge">/etc/smartd.conf</code> :<br /> <code class="highlighter-rouge">/dev/sdX -a -o on -S on -s (S/../.././02|L/../../6/03) -W 4,35,45 -m your_email_address_here</code><br /> (This presuppone you have setup your system to send emails)</p> <p>11 - Create directory for mount:<br /> <code class="highlighter-rouge">sudo mkdir /new_disk</code><br /> <code class="highlighter-rouge">sudo chown yourname:yourgroup /new_disk</code></p> <p>12 - Setup <code class="highlighter-rouge">/etc/fstab</code> with something like:<br /> <code class="highlighter-rouge">UUID=19f67802-02aa-4090-8708-93de963ddf79 /new_disk ext4 defaults 0 2</code><br /> You can get the uid using<br /> <code class="highlighter-rouge">ls -l /dev/disk/by-uuid/</code> and look for the one that links to sdX1</p> <p>13 - Try to mount<br /> <code class="highlighter-rouge">sudo mount /new_disk</code></p> <p>Done!</p> <i>Last update: 19 June 2020</i> </article> </main> <aside> <!-- Contents --> <div class="sideblock"> <nav> <h3>Contents</h3> <hr /> <ul> <li><i class="fas fa-home fa-fw"></i> <a href="/">Home</a> </li> <li><i class="fas fa-user-circle fa-fw"></i> <a href="/cv/">CV</a> </li> <li><i class="fas fa-flask fa-fw"></i> <a href="/research/">Research Projects</a> </li> <li><i class="fas fa-book fa-fw"></i> <a href="/publications/">Publications</a> </li> <li><i class="fas fa-code fa-fw"></i> <a href="/programming/">C Programming</a> </li> <li><i class="fas fa-gem fa-fw"></i> <a href="/minerals/">Minerals</a> </li> <li><i class="fas fa-star fa-fw"></i> <a href="/mineralapp/">MineralApp</a> </li> <li><i class="fas fa-paper-plane fa-fw"></i> <a href="/stuff/">Stuff</a> <ul> <li><a href="/stuff/periodictable/">Periodic Tables</a> </li> <li><a href="/stuff/solareclipse/">Solar Eclipse</a> </li> <li><a href="/stuff/juggling/">Juggling</a> </li> </ul> </li> <li><i class="fas fa-envelope fa-fw"></i> <a href="/contact/">Contact</a> </li> </ul> </nav> </div> </aside> <footer> <p>Copyright &copy; 2015-2021 Simone Conti. All rights reserved.</p> </footer> </body> </html>
